{"ast":null,"code":"import React,{createContext,useState,useEffect}from'react';import{jsx as _jsx}from\"react/jsx-runtime\";export const AuthContext=/*#__PURE__*/createContext();export const AuthProvider=_ref=>{let{children}=_ref;const[user,setUser]=useState(null);const[loading,setLoading]=useState(true);// Check for existing token on app start\nuseEffect(()=>{const checkAuthStatus=async()=>{try{const token=localStorage.getItem('token');if(token){// Verify token with backend\nconst response=await fetch('http://localhost:5000/api/auth/verify',{method:'GET',headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},credentials:'include'});if(response.ok){const data=await response.json();if(data.success&&data.user){setUser(data.user);}else{localStorage.removeItem('token');}}else{localStorage.removeItem('token');}}}catch(error){console.error('Auth check error:',error);localStorage.removeItem('token');}finally{setLoading(false);}};checkAuthStatus();},[]);const login=async credentials=>{try{console.log('Attempting login with credentials:',credentials);// Make API call to backend for authentication\nconst response=await fetch('http://localhost:5000/api/auth/login',{method:'POST',headers:{'Content-Type':'application/json'},credentials:'include',body:JSON.stringify(credentials)});console.log('Login response status:',response.status);const data=await response.json();console.log('Login response data:',data);if(!response.ok){// Handle specific error cases\nif(response.status===401){throw new Error(data.message||'Invalid credentials');}else if(response.status===423){throw new Error('Account locked due to multiple failed attempts');}else if(response.status===403){throw new Error('Account deactivated. Contact administrator');}else{throw new Error(data.message||'Login failed');}}if(!data.success){throw new Error(data.message||'Login failed');}// Validate user data\nif(!data.user||!data.user.id){throw new Error('Invalid user data received');}// Check if user is active\nif(data.user.isActive===false){throw new Error('Your account has been deactivated');}// Store token and user data\nif(data.token){localStorage.setItem('token',data.token);}setUser(data.user);return data;}catch(error){console.error('Login error:',error);throw error;}};const logout=async()=>{try{const token=localStorage.getItem('token');if(token){// Call backend logout\nawait fetch('http://localhost:5000/api/auth/logout',{method:'POST',headers:{'Authorization':`Bearer ${token}`,'Content-Type':'application/json'},credentials:'include'});}}catch(error){console.error('Logout error:',error);}finally{// Always clean up local state\nlocalStorage.removeItem('token');setUser(null);}};const value={user,login,logout,loading,isAuthenticated:!!user};return/*#__PURE__*/_jsx(AuthContext.Provider,{value:value,children:children});};","map":{"version":3,"names":["React","createContext","useState","useEffect","jsx","_jsx","AuthContext","AuthProvider","_ref","children","user","setUser","loading","setLoading","checkAuthStatus","token","localStorage","getItem","response","fetch","method","headers","credentials","ok","data","json","success","removeItem","error","console","login","log","body","JSON","stringify","status","Error","message","id","isActive","setItem","logout","value","isAuthenticated","Provider"],"sources":["B:/PortAuthProject/TimeTracker_SLPA/frontend/src/context/AuthContext.js"],"sourcesContent":["import React, { createContext, useState, useEffect } from 'react';\r\n\r\nexport const AuthContext = createContext();\r\n\r\nexport const AuthProvider = ({ children }) => {\r\n  const [user, setUser] = useState(null);\r\n  const [loading, setLoading] = useState(true);\r\n\r\n  // Check for existing token on app start\r\n  useEffect(() => {\r\n    const checkAuthStatus = async () => {\r\n      try {\r\n        const token = localStorage.getItem('token');\r\n        if (token) {\r\n          // Verify token with backend\r\n          const response = await fetch('http://localhost:5000/api/auth/verify', {\r\n            method: 'GET',\r\n            headers: {\r\n              'Authorization': `Bearer ${token}`,\r\n              'Content-Type': 'application/json'\r\n            },\r\n            credentials: 'include'\r\n          });\r\n\r\n          if (response.ok) {\r\n            const data = await response.json();\r\n            if (data.success && data.user) {\r\n              setUser(data.user);\r\n            } else {\r\n              localStorage.removeItem('token');\r\n            }\r\n          } else {\r\n            localStorage.removeItem('token');\r\n          }\r\n        }\r\n      } catch (error) {\r\n        console.error('Auth check error:', error);\r\n        localStorage.removeItem('token');\r\n      } finally {\r\n        setLoading(false);\r\n      }\r\n    };\r\n\r\n    checkAuthStatus();\r\n  }, []);\r\n\r\n  const login = async (credentials) => {\r\n    try {\r\n      console.log('Attempting login with credentials:', credentials);\r\n      \r\n      // Make API call to backend for authentication\r\n      const response = await fetch('http://localhost:5000/api/auth/login', {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json'\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify(credentials)\r\n      });\r\n\r\n      console.log('Login response status:', response.status);\r\n      const data = await response.json();\r\n      console.log('Login response data:', data);\r\n\r\n      if (!response.ok) {\r\n        // Handle specific error cases\r\n        if (response.status === 401) {\r\n          throw new Error(data.message || 'Invalid credentials');\r\n        } else if (response.status === 423) {\r\n          throw new Error('Account locked due to multiple failed attempts');\r\n        } else if (response.status === 403) {\r\n          throw new Error('Account deactivated. Contact administrator');\r\n        } else {\r\n          throw new Error(data.message || 'Login failed');\r\n        }\r\n      }\r\n\r\n      if (!data.success) {\r\n        throw new Error(data.message || 'Login failed');\r\n      }\r\n\r\n      // Validate user data\r\n      if (!data.user || !data.user.id) {\r\n        throw new Error('Invalid user data received');\r\n      }\r\n\r\n      // Check if user is active\r\n      if (data.user.isActive === false) {\r\n        throw new Error('Your account has been deactivated');\r\n      }\r\n\r\n      // Store token and user data\r\n      if (data.token) {\r\n        localStorage.setItem('token', data.token);\r\n      }\r\n      \r\n      setUser(data.user);\r\n      return data;\r\n\r\n    } catch (error) {\r\n      console.error('Login error:', error);\r\n      throw error;\r\n    }\r\n  };\r\n\r\n  const logout = async () => {\r\n    try {\r\n      const token = localStorage.getItem('token');\r\n      if (token) {\r\n        // Call backend logout\r\n        await fetch('http://localhost:5000/api/auth/logout', {\r\n          method: 'POST',\r\n          headers: {\r\n            'Authorization': `Bearer ${token}`,\r\n            'Content-Type': 'application/json'\r\n          },\r\n          credentials: 'include'\r\n        });\r\n      }\r\n    } catch (error) {\r\n      console.error('Logout error:', error);\r\n    } finally {\r\n      // Always clean up local state\r\n      localStorage.removeItem('token');\r\n      setUser(null);\r\n    }\r\n  };\r\n\r\n  const value = {\r\n    user,\r\n    login,\r\n    logout,\r\n    loading,\r\n    isAuthenticated: !!user\r\n  };\r\n\r\n  return (\r\n    <AuthContext.Provider value={value}>\r\n      {children}\r\n    </AuthContext.Provider>\r\n  );\r\n};"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}