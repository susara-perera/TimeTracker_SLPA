{"ast":null,"code":"var _s = $RefreshSig$();\nimport { useContext } from 'react';\nimport { AuthContext } from '../context/AuthContext';\n\n// usePermission(resource, action) -> boolean\n// resource: string like 'users', 'divisions', 'attendance'\n// action: 'read'|'create'|'update'|'delete'|'edit'\nexport default function usePermission(resource, action) {\n  _s();\n  const {\n    user\n  } = useContext(AuthContext) || {};\n  if (!user) return false;\n  if (user.role === 'super_admin') return true;\n  const perms = user.permissions;\n  if (!perms) return false;\n\n  // Normalize action aliases\n  const actionAliases = {\n    read: ['read', 'view'],\n    create: ['create', 'add'],\n    update: ['update', 'edit'],\n    delete: ['delete', 'remove']\n  };\n  const actionsToCheck = actionAliases[action] || [action];\n\n  // Check plural/singular resource variants\n  const resourcesToCheck = [resource];\n  if (resource.endsWith('s')) resourcesToCheck.push(resource.slice(0, -1));else resourcesToCheck.push(resource + 's');\n  for (const r of resourcesToCheck) {\n    const rPerm = perms[r];\n    if (rPerm === undefined) continue;\n\n    // boolean permission shortcut\n    if (typeof rPerm === 'boolean') {\n      if (rPerm) return true;\n      continue;\n    }\n\n    // array of allowed actions\n    if (Array.isArray(rPerm)) {\n      for (const a of actionsToCheck) if (rPerm.includes(a)) return true;\n      continue;\n    }\n\n    // object mapping actions -> boolean\n    if (typeof rPerm === 'object' && rPerm !== null) {\n      for (const a of actionsToCheck) {\n        const val = rPerm[a];\n        if (val === true || val === 'true' || val === 1) return true;\n      }\n    }\n  }\n\n  // optional debug\n  try {\n    if (typeof window !== 'undefined' && window.DEBUG_PERMS) {\n      console.debug('usePermission', {\n        user: (user === null || user === void 0 ? void 0 : user.id) || (user === null || user === void 0 ? void 0 : user.email),\n        resource,\n        action,\n        resourcesToCheck,\n        actionsToCheck,\n        perms\n      });\n    }\n  } catch (e) {}\n  return false;\n}\n_s(usePermission, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");","map":{"version":3,"names":["useContext","AuthContext","usePermission","resource","action","_s","user","role","perms","permissions","actionAliases","read","create","update","delete","actionsToCheck","resourcesToCheck","endsWith","push","slice","r","rPerm","undefined","Array","isArray","a","includes","val","window","DEBUG_PERMS","console","debug","id","email","e"],"sources":["B:/PortAuthProject/TimeTracker_SLPA/frontend/src/hooks/usePermission.js"],"sourcesContent":["import { useContext } from 'react';\r\nimport { AuthContext } from '../context/AuthContext';\r\n\r\n// usePermission(resource, action) -> boolean\r\n// resource: string like 'users', 'divisions', 'attendance'\r\n// action: 'read'|'create'|'update'|'delete'|'edit'\r\nexport default function usePermission(resource, action) {\r\n  const { user } = useContext(AuthContext) || {};\r\n  if (!user) return false;\r\n  if (user.role === 'super_admin') return true;\r\n\r\n  const perms = user.permissions;\r\n  if (!perms) return false;\r\n\r\n  // Normalize action aliases\r\n  const actionAliases = {\r\n    read: ['read', 'view'],\r\n    create: ['create', 'add'],\r\n    update: ['update', 'edit'],\r\n    delete: ['delete', 'remove']\r\n  };\r\n\r\n  const actionsToCheck = actionAliases[action] || [action];\r\n\r\n  // Check plural/singular resource variants\r\n  const resourcesToCheck = [resource];\r\n  if (resource.endsWith('s')) resourcesToCheck.push(resource.slice(0, -1));\r\n  else resourcesToCheck.push(resource + 's');\r\n\r\n  for (const r of resourcesToCheck) {\r\n    const rPerm = perms[r];\r\n    if (rPerm === undefined) continue;\r\n\r\n    // boolean permission shortcut\r\n    if (typeof rPerm === 'boolean') {\r\n      if (rPerm) return true;\r\n      continue;\r\n    }\r\n\r\n    // array of allowed actions\r\n    if (Array.isArray(rPerm)) {\r\n      for (const a of actionsToCheck) if (rPerm.includes(a)) return true;\r\n      continue;\r\n    }\r\n\r\n    // object mapping actions -> boolean\r\n    if (typeof rPerm === 'object' && rPerm !== null) {\r\n      for (const a of actionsToCheck) {\r\n        const val = rPerm[a];\r\n        if (val === true || val === 'true' || val === 1) return true;\r\n      }\r\n    }\r\n  }\r\n\r\n  // optional debug\r\n  try {\r\n    if (typeof window !== 'undefined' && window.DEBUG_PERMS) {\r\n      console.debug('usePermission', { user: user?.id || user?.email, resource, action, resourcesToCheck, actionsToCheck, perms });\r\n    }\r\n  } catch (e) {}\r\n\r\n  return false;\r\n}\r\n"],"mappings":";AAAA,SAASA,UAAU,QAAQ,OAAO;AAClC,SAASC,WAAW,QAAQ,wBAAwB;;AAEpD;AACA;AACA;AACA,eAAe,SAASC,aAAaA,CAACC,QAAQ,EAAEC,MAAM,EAAE;EAAAC,EAAA;EACtD,MAAM;IAAEC;EAAK,CAAC,GAAGN,UAAU,CAACC,WAAW,CAAC,IAAI,CAAC,CAAC;EAC9C,IAAI,CAACK,IAAI,EAAE,OAAO,KAAK;EACvB,IAAIA,IAAI,CAACC,IAAI,KAAK,aAAa,EAAE,OAAO,IAAI;EAE5C,MAAMC,KAAK,GAAGF,IAAI,CAACG,WAAW;EAC9B,IAAI,CAACD,KAAK,EAAE,OAAO,KAAK;;EAExB;EACA,MAAME,aAAa,GAAG;IACpBC,IAAI,EAAE,CAAC,MAAM,EAAE,MAAM,CAAC;IACtBC,MAAM,EAAE,CAAC,QAAQ,EAAE,KAAK,CAAC;IACzBC,MAAM,EAAE,CAAC,QAAQ,EAAE,MAAM,CAAC;IAC1BC,MAAM,EAAE,CAAC,QAAQ,EAAE,QAAQ;EAC7B,CAAC;EAED,MAAMC,cAAc,GAAGL,aAAa,CAACN,MAAM,CAAC,IAAI,CAACA,MAAM,CAAC;;EAExD;EACA,MAAMY,gBAAgB,GAAG,CAACb,QAAQ,CAAC;EACnC,IAAIA,QAAQ,CAACc,QAAQ,CAAC,GAAG,CAAC,EAAED,gBAAgB,CAACE,IAAI,CAACf,QAAQ,CAACgB,KAAK,CAAC,CAAC,EAAE,CAAC,CAAC,CAAC,CAAC,CAAC,KACpEH,gBAAgB,CAACE,IAAI,CAACf,QAAQ,GAAG,GAAG,CAAC;EAE1C,KAAK,MAAMiB,CAAC,IAAIJ,gBAAgB,EAAE;IAChC,MAAMK,KAAK,GAAGb,KAAK,CAACY,CAAC,CAAC;IACtB,IAAIC,KAAK,KAAKC,SAAS,EAAE;;IAEzB;IACA,IAAI,OAAOD,KAAK,KAAK,SAAS,EAAE;MAC9B,IAAIA,KAAK,EAAE,OAAO,IAAI;MACtB;IACF;;IAEA;IACA,IAAIE,KAAK,CAACC,OAAO,CAACH,KAAK,CAAC,EAAE;MACxB,KAAK,MAAMI,CAAC,IAAIV,cAAc,EAAE,IAAIM,KAAK,CAACK,QAAQ,CAACD,CAAC,CAAC,EAAE,OAAO,IAAI;MAClE;IACF;;IAEA;IACA,IAAI,OAAOJ,KAAK,KAAK,QAAQ,IAAIA,KAAK,KAAK,IAAI,EAAE;MAC/C,KAAK,MAAMI,CAAC,IAAIV,cAAc,EAAE;QAC9B,MAAMY,GAAG,GAAGN,KAAK,CAACI,CAAC,CAAC;QACpB,IAAIE,GAAG,KAAK,IAAI,IAAIA,GAAG,KAAK,MAAM,IAAIA,GAAG,KAAK,CAAC,EAAE,OAAO,IAAI;MAC9D;IACF;EACF;;EAEA;EACA,IAAI;IACF,IAAI,OAAOC,MAAM,KAAK,WAAW,IAAIA,MAAM,CAACC,WAAW,EAAE;MACvDC,OAAO,CAACC,KAAK,CAAC,eAAe,EAAE;QAAEzB,IAAI,EAAE,CAAAA,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE0B,EAAE,MAAI1B,IAAI,aAAJA,IAAI,uBAAJA,IAAI,CAAE2B,KAAK;QAAE9B,QAAQ;QAAEC,MAAM;QAAEY,gBAAgB;QAAED,cAAc;QAAEP;MAAM,CAAC,CAAC;IAC9H;EACF,CAAC,CAAC,OAAO0B,CAAC,EAAE,CAAC;EAEb,OAAO,KAAK;AACd;AAAC7B,EAAA,CAxDuBH,aAAa","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}